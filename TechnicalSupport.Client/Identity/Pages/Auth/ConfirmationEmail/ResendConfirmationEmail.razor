@page "/auth/confirmemail"

@layout LoginLayout

<RadzenPanel Style="--rz-primary-light;width:fit-content;margin:auto">

    <RadzenStack JustifyContent="JustifyContent.Center"
                 AlignItems="AlignItems.Center"
                 Style="margin-bottom:10px">
        <RadzenImage Path="@UpdateImagePath()" Style="width:325px;height:325px" />
    </RadzenStack>

    <RadzenText Text="@MyText.confirmationEmailSendSuccessfully" class="text-center fw-bold" />

    <RadzenText Text="@MyText.checkYourEmailToActicateYourAccount" class="text-center" />

    <RadzenRow AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center">

        <EditForm Model="@_resendConfirmationEmailRequest" OnValidSubmit="ResendConfirmationEmailFunc">
            <DataAnnotationsValidator />

            <RadzenStack>
                <RadzenFormField Text="Email">
                    <Start>
                        <RadzenIcon Icon="@GoogleIcons.Email" />
                    </Start>
                    <ChildContent>
                        <RadzenTextBox Style="width:300px" @bind-Value="@_resendConfirmationEmailRequest.Email" />
                    </ChildContent>
                </RadzenFormField>
                <ValidationMessage For="(() => _resendConfirmationEmailRequest.Email)" />

                <RadzenFormField>
                    <RadzenButton Style="width:300px"
                                  ButtonType="ButtonType.Submit"
                                  ButtonStyle="ButtonStyle.Primary">
                        @MyText.resendEmailConfirmation
                    </RadzenButton>
                </RadzenFormField>

            </RadzenStack>
        </EditForm>
    </RadzenRow>

</RadzenPanel>

<Notification @ref="_notificationRef" />

@code {

    #region Cascading Parameters

    [CascadingParameter(Name = Strings.LoginLayoutTheme)]
    public string LoginTheme { get; set; }

    #endregion

    #region Injects

    [Inject]
    private IAuthenticationServiceFactory? _authenticationService { get; set; }

    #endregion

    #region Variables

    private I18nText.MyText MyText = new();

    private ResendConfirmationEmailRequest _resendConfirmationEmailRequest = new();

    private string? _imagePath { get; set; }

    private Notification _notificationRef;

    #endregion

    #region Methods

    protected override async Task OnInitializedAsync() => MyText = await I18nText.GetTextTableAsync<I18nText.MyText>(this);

    private string UpdateImagePath() => _imagePath = $"{Strings.ImagePath}{Strings.ConfirmedEmailImage}{GetThemeSuffix()}.png";

    private string GetThemeSuffix() => LoginTheme == Strings.Dark ? "-dark" : string.Empty;

    private async Task ResendConfirmationEmailFunc()
    {
        var result = await _authenticationService?.ResendConfirmEmail(_resendConfirmationEmailRequest, InternalRoutes.EmailConfirmation)!;
        if (result.Success)
            _notificationRef.ShowNotifications(MyText.emailEndSuccesfully, MyText.checkEmail, NotificationSeverity.Success);
        else
            _notificationRef.ShowNotifications(MyText.failedToSendEmail, MyText.emailAlreadyConfirmed, NotificationSeverity.Error);
    }

    #endregion
}
